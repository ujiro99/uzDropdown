/**!
  uz-dropdown 0.4.5
  https://github.com/ujiro99/uzDropdown
  License: MIT

  Copyright (C) 2014 ujiro99
*/
angular.module("uz",[]).directive("uzDropdown",function(){return{restrict:"E",template:"<div class='dropdown'><input tabindex='0'class='dropdown-text dropdown-toggle'ng-model='keyword'placeholder='{{placeholder}}'ng-blur='onBlur()'ng-keydown='onKeydown($event.keyCode)'></input><div class='dropdown-box'><ul class='dropdown-content'><li ng-repeat='item in result = (itemFilter(items) | orderBy:order)'ng-click='onClickItem(item)'ng-mouseover='onMouseoverItem($index)'ng-class='{selected: item === selected[0], focused: $index === focusIndex}'><a><span>{{$format(format, item)}}</span></a></li><li ng-if='result.length == 0'><a><span>not found ...</span></a></li><li ng-if='result.length >= listMax' ng-mouseover='onMouseover()'><a><span>more ...</span></a></li></ul></div>",scope:{items:"=",selected:"=",keyword:"=",placeholder:"@"},link:function(a,b,c){var d,e,f,g,h,i,j,k;return f=13,g=38,e=40,h=100,i=" ",d="{0}",a.items=a.items||[],a.selected=a.selected||[],a.result=[],a.format=c.format||d,a.order=c.orderby||"",a.listMax=h,a.focusIndex=0,k=function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},a.$format=function(a,b){var c,d;return d=void 0,"object"==typeof b?d=function(a,c){var d,e,f,g,h;for(e=c.split("."),f=b,g=0,h=e.length;h>g;g++)d=e[g],f=f[d];return f}:(c=arguments,d=function(a,b){return c[parseInt(b)+1]}),a.replace(/\{(.+?)\}/g,d)},a.itemFilter=function(b){var c,d,e,f,g,h,j,l,m,n,o,p,q,r,s,t;if(null==b||0===b.length)return[];if(!a.keyword)return c=b.length<a.listMax?b.length:a.listMax,b.slice(0,c);for(m=[],j=a.keyword.split(i),o=0,r=j.length;r>o;o++)h=j[o],m.push(new RegExp(k(h),["i"]));for(d=[],e=p=0,s=b.length;s>p;e=++p){for(g=b[e],n=a.$format(a.format,g),f=!0,q=0,t=m.length;t>q;q++)l=m[q],f&=l.test(n);f&&d.length<a.listMax&&d.push(g)}return d},b[0].querySelector("input").onfocus=function(){return this.select()},a.onBlur=function(){return a.keyword||(a.selected[0]=void 0),a.listMax=h},a.onClickItem=function(b){return a.selected[0]=b,a.keyword=a.$format(a.format,b)},a.onKeydown=function(b){return b===f?j():b===e?a.focusIndex++:b===g&&a.focusIndex--,a.focusIndex<0&&(a.focusIndex=0),a.focusIndex>=a.result.length?a.focusIndex=a.result.length-1:void 0},j=function(){var b;return b=a.result[a.focusIndex],b&&(a.keyword=a.$format(a.format,b)),a.selected[0]=b},a.onMouseover=function(){return a.listMax+=100},a.onMouseoverItem=function(b){return a.focusIndex=b},a.$watch("result.length",function(){return a.focusIndex=0})}}});