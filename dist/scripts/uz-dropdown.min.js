angular.module("uz",[]).directive("uzDropdown",["$timeout",function($timeout){return{restrict:"E",template:"<div class='dropdown'><input tabindex='0'class='dropdown-text dropdown-toggle'ng-model='keyword'placeholder='{{placeholder}}'ng-keydown='onKeydown($event.keyCode)'></input><div class='dropdown-box'><ul class='dropdown-content'><li ng-repeat='item in result = (items | filter:itemFilter)'ng-click='onClickItem(item)'ng-class='{active: item === selected[0]}'><a><span>{{$eval($parent.format)}}</span></a></li></ul></div>",scope:{items:"=",selected:"=",placeholder:"@"},link:function(scope,element,attrs){var KEY_DOWN,KEY_ENTER,KEY_UP,SPLIT_SPACE,escapeRegExp,_searchRegex,_selectIndex;return KEY_ENTER=13,KEY_UP=38,KEY_DOWN=40,SPLIT_SPACE=" ",_selectIndex=0,_searchRegex={},escapeRegExp=function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},scope.keyword="",scope.result=[],scope.format=attrs.format||"item.text",scope.selectedFormat=attrs.selectedFormat||"selected[0].text",scope.itemFilter=function(item){var isMatch,k,keywords,reg,target,_i,_j,_len,_len1,_ref;if(!_searchRegex[scope.keyword])for(_searchRegex={},_searchRegex[scope.keyword]=[],keywords=scope.keyword.split(SPLIT_SPACE),_i=0,_len=keywords.length;_len>_i;_i++)k=keywords[_i],_searchRegex[scope.keyword].push(new RegExp(escapeRegExp(k),["i"]));for(target=eval(scope.format),isMatch=!0,_ref=_searchRegex[scope.keyword],_j=0,_len1=_ref.length;_len1>_j;_j++)reg=_ref[_j],isMatch&=reg.test(target);return isMatch},element[0].querySelector("input").onfocus=function(){return this.select()},scope.onClickItem=function(item){return scope.selected[0]=item,scope.keyword=eval("scope."+scope.selectedFormat)},scope.onKeydown=function(keycode){var tmpSelected;return keycode===KEY_ENTER?(scope.keyword=eval("scope."+scope.selectedFormat),tmpSelected=scope.result[_selectIndex]):keycode===KEY_DOWN?_selectIndex++:keycode===KEY_UP&&_selectIndex--,0>_selectIndex&&(_selectIndex=0),_selectIndex>=scope.result.length&&(_selectIndex=scope.result.length-1),tmpSelected=scope.result[_selectIndex],$timeout(function(){return scope.selected[0]=tmpSelected})},scope.$watch("result.length",function(){return _selectIndex=0,$timeout(function(){return scope.selected[0]=scope.result[_selectIndex]})})}}}]);